# 如何在 aaPanel (宝塔) 部署 IceAlan High School (PHP版)

此版本使用 **React 作为前端**，**PHP 作为后端数据库**。这允许你在后台所做的更改被**永久保存**在服务器上。

## 1. 编译前端代码

在你的本地电脑项目文件夹中运行：

```bash
npm run build
```

这会生成一个 `dist` 文件夹。

## 2. 宝塔 (aaPanel) 设置站点

1. 登录宝塔面板。
2. 点击 **网站 (Website)** -> **添加站点 (Add Site)**。
3. **域名**: 输入你的域名或 IP。
4. **PHP 版本**: **必须选择 PHP 版本** (推荐 PHP 7.4 或 8.0+)。不能选“纯静态(Static)”，否则无法保存数据。
5. **数据库**: 不需要 MySQL (我们使用 JSON 文件存储)，选“不创建”。
6. 提交。

## 3. 上传文件

1. 进入网站根目录 (例如 `/www/wwwroot/你的域名/`)。
2. 删除默认的 `index.html` 和 `404.html`。
3. **关键步骤**: 
   将本地 `dist` 文件夹里的**所有内容**上传到服务器目录。
   
   *注意：`api.php` 文件通常会自动包含在 build 里（如果在 public 文件夹中），或者你可以单独上传 `api.php` 到网站根目录。确保 `api.php` 和 `index.html` 在同一级目录。*

## 4. 设置文件权限 (非常重要)

为了让 PHP 能够保存数据，它需要有权限在文件夹中创建和写入文件。

1. 在宝塔文件管理器中，找到你的网站根目录。
2. 确保目录权限是 `755`，所有者是 `www` (通常默认就是)。
3. 如果保存失败，可以尝试手动创建一个名为 `school_data.json` 的空文件，并将该文件的权限设置为 `666` 或 `777`。

## 5. 配置 Nginx (伪静态)

为了让 React 路由正常工作，必须设置伪静态。

1. 点击网站设置 -> **伪静态 (URL Rewrite)**。
2. 粘贴以下代码：

```nginx
location / {
  try_files $uri $uri/ /index.html;
}
```
3. 保存。

## 6. 完成

现在访问你的网站。
1. 首次加载时，PHP 会读取默认数据。
2. 登录后台 (`admin` / `admin`)。
3. 修改任意内容（例如校训或添加教职工）。
4. 刷新页面，或者用手机访问，你会发现**修改被永久保存了**。

---

**故障排除**:
- 如果无法保存: 检查 `/www/wwwroot/你的域名/` 目录下是否有 `school_data.json` 生成。如果没有，通常是权限问题。
- 如果页面 404: 检查第 5 步伪静态是否配置正确。
